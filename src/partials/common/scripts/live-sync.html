<script type="text/javascript">
    (function() {
        /*global firebase*/
        /*global localStorage*/
        var isDevEnv = function() {
            return window.location.origin.indexOf('c9users') !== -1;
        }
        if (!isDevEnv()) return console.log('live-sync', 'not-a-dev-enviroment');
        console.info('live-sync-enabled signalName => {{signalName}}');
        var config = {
            apiKey: "AIzaSyCqh03BCNeafvQCHd3i82h-3TyeREmT3eU",
            authDomain: "getabiker-1276e.firebaseapp.com",
            databaseURL: "https://getabiker-1276e.firebaseio.com",
            //storageBucket: "getabiker.appspot.com",
            //messagingSenderId: "626641878895"
        };
        var app =firebase.initializeApp(config, 'live-reload');
        var database = app.database();
        
        var refPath = '{{signalName}}/signals/reload'
        var ref = database.ref(refPath);
        var counter = localStorage['livesync'] && localStorage['livesync'].toString() || 0;
        
        
        //console.info('live-sync-enabled signalName','{{signalName}}','counter',counter,'path',refPath);
        
        ref.on('value', function(snap) {
            if (snap.val() == null || snap.val() == undefined) return; //nothing happen yet
            
            
            //console.log('new',snap.val().toString());
            //console.log('local',counter);
            
            if (snap.val().toString() != counter) {
                localStorage['livesync'] = snap.val().toString();
                console.log('live-sync-reloading');
                window.location.reload();
            }
            else {
                console.log('live-sync-waiting');
            }
        });
    })();
</script>
